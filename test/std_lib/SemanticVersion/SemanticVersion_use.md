è¿™æ®µä»£ç æ˜¯ç”¨ **Zig** è¯­è¨€å®ç°çš„ä¸€ä¸ªç¬¦åˆ [**Semantic Versioning 2.0.0**](https://semver.org)ï¼ˆç®€ç§° **SemVer**ï¼‰è§„èŒƒçš„ç‰ˆæœ¬å·å¤„ç†æ¨¡å—ã€‚ä¸‹é¢æˆ‘å°†é€æ­¥ä¸ºä½ è¯¦ç»†è§£é‡Šå…¶åŠŸèƒ½ã€ç»“æ„å’Œå…³é”®é€»è¾‘ã€‚

---

## ğŸ“Œ æ¨¡å—æ¦‚è¿°

```zig
//! A software version formatted according to the Semantic Versioning 2.0.0 specification.
//! See: https://semver.org
```

è¿™æ˜¯ä¸€ä¸ªæ–‡æ¡£æ³¨é‡Šï¼Œè¯´æ˜è¿™ä¸ªæ¨¡å—ç”¨äºè¡¨ç¤ºå’Œæ“ä½œç¬¦åˆ **SemVer 2.0.0** æ ‡å‡†çš„è½¯ä»¶ç‰ˆæœ¬å·ã€‚

---

## ğŸ”§ æ•°æ®ç»“æ„ï¼š`Version`

```zig
const Version = @This();

major: usize,
minor: usize,
patch: usize,
pre: ?[]const u8 = null,
build: ?[]const u8 = null,
```

`Version` æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œä»£è¡¨ä¸€ä¸ªè¯­ä¹‰åŒ–ç‰ˆæœ¬å·ï¼ŒåŒ…å«äº”ä¸ªå­—æ®µï¼š

| å­—æ®µ | å«ä¹‰ | ç¤ºä¾‹ |
|------|------|------|
| `major` | ä¸»ç‰ˆæœ¬å· | `1` in `1.2.3` |
| `minor` | æ¬¡ç‰ˆæœ¬å· | `2` in `1.2.3` |
| `patch` | ä¿®è®¢ç‰ˆæœ¬å· | `3` in `1.2.3` |
| `pre` | é¢„å‘å¸ƒæ ‡è¯†ç¬¦ï¼ˆå¯é€‰ï¼‰ | `-alpha.1` |
| `build` | æ„å»ºå…ƒæ•°æ®ï¼ˆå¯é€‰ï¼Œä¸å‚ä¸æ¯”è¾ƒï¼‰ | `+build.123` |

> âœ… æ³¨æ„ï¼šæ ¹æ® SemVer è§„èŒƒï¼Œ`build` å­—æ®µ **ä¸å‚ä¸ç‰ˆæœ¬ä¼˜å…ˆçº§æ¯”è¾ƒ**ï¼Œä»…ç”¨äºæ ‡è¯†æ„å»ºä¿¡æ¯ã€‚

---

## ğŸ§© å­ç»“æ„ä½“ï¼š`Range`

```zig
pub const Range = struct {
    min: Version,
    max: Version,
};
```

è¡¨ç¤ºä¸€ä¸ªç‰ˆæœ¬èŒƒå›´ï¼Œä» `min` åˆ° `max`ï¼ˆé—­åŒºé—´ï¼‰ã€‚

### æ–¹æ³• 1ï¼š`includesVersion`

```zig
pub fn includesVersion(self: Range, ver: Version) bool {
    if (self.min.order(ver) == .gt) return false;
    if (self.max.order(ver) == .lt) return false;
    return true;
}
```

åˆ¤æ–­æŸä¸ªç‰ˆæœ¬ `ver` æ˜¯å¦åœ¨ `[min, max]` èŒƒå›´å†…ã€‚

- å¦‚æœ `ver < min` â†’ è¿”å› `false`
- å¦‚æœ `ver > max` â†’ è¿”å› `false`
- å¦åˆ™è¿”å› `true`

### æ–¹æ³• 2ï¼š`isAtLeast`

```zig
pub fn isAtLeast(self: Range, ver: Version) ?bool
```

æ£€æŸ¥å½“å‰ç‰ˆæœ¬èŒƒå›´æ˜¯å¦**ä¸€å®šå¤§äºç­‰äº**ç»™å®šç‰ˆæœ¬ `ver`ï¼š

- è‹¥ `min >= ver` â†’ è¿”å› `true`
- è‹¥ `max < ver` â†’ è¿”å› `false`
- å¦åˆ™ï¼ˆæ¯”å¦‚ `min < ver <= max`ï¼‰â†’ è¿”å› `null`ï¼Œè¡¨ç¤ºéœ€è¦è¿è¡Œæ—¶åˆ¤æ–­

> è¿™ä¸ªå‡½æ•°é€‚ç”¨äºç¼–è¯‘æœŸå¸¸é‡åˆ¤æ–­ï¼Œä¾‹å¦‚ç”¨äºæ¡ä»¶ç¼–è¯‘ã€‚

---

## ğŸ” ç‰ˆæœ¬æ¯”è¾ƒï¼š`order`

```zig
pub fn order(lhs: Version, rhs: Version) std.math.Order
```

è¿™æ˜¯æ ¸å¿ƒå‡½æ•°ï¼Œå®ç° **SemVer çš„ä¼˜å…ˆçº§æ’åºè§„åˆ™**ã€‚è¿”å›å€¼ä¸º `.lt`ï¼ˆå°äºï¼‰ã€`.eq`ï¼ˆç­‰äºï¼‰ã€`.gt`ï¼ˆå¤§äºï¼‰ã€‚

### æ¯”è¾ƒé¡ºåºå¦‚ä¸‹ï¼š

1. **ä¸»ç‰ˆæœ¬ã€æ¬¡ç‰ˆæœ¬ã€ä¿®è®¢å·**ï¼šé€çº§æ•°å­—æ¯”è¾ƒã€‚
2. **é¢„å‘å¸ƒç‰ˆæœ¬ (`pre`)**ï¼š
   - æœ‰é¢„å‘å¸ƒçš„ç‰ˆæœ¬ < æ— é¢„å‘å¸ƒçš„ç‰ˆæœ¬ï¼ˆå³ `1.0.0-alpha < 1.0.0`ï¼‰
   - å¦‚æœéƒ½æœ‰é¢„å‘å¸ƒï¼Œåˆ™æŒ‰ `.` åˆ†å‰²æˆå¤šä¸ªæ ‡è¯†ç¬¦è¿›è¡Œæ¯”è¾ƒ
3. **æ ‡è¯†ç¬¦æ¯”è¾ƒè§„åˆ™**ï¼š
   - æ•°å­—æ ‡è¯†ç¬¦ vs æ•°å­—æ ‡è¯†ç¬¦ â†’ æŒ‰æ•°å€¼æ¯”è¾ƒï¼ˆ`1 < 2`ï¼‰
   - æ•°å­— vs éæ•°å­— â†’ æ•°å­—ä¼˜å…ˆçº§æ›´ä½ï¼ˆ`1 < beta`ï¼‰
   - éæ•°å­— vs éæ•°å­— â†’ ASCII å­—å…¸åºæ¯”è¾ƒï¼ˆ`alpha < beta`ï¼‰
4. **é•¿åº¦å·®å¼‚**ï¼šæ›´å¤šæ®µçš„é¢„å‘å¸ƒæ ‡è¯†ç¬¦ä¼˜å…ˆçº§æ›´é«˜ï¼ˆ`1.0.0-alpha.1 < 1.0.0-alpha.1.1`ï¼‰

> âš ï¸ æ„å»ºå…ƒæ•°æ® `build` ä¸å‚ä¸æ¯”è¾ƒï¼

---

## ğŸ§ª ç‰ˆæœ¬è§£æï¼š`parse`

```zig
pub fn parse(text: []const u8) !Version
```

å°†å­—ç¬¦ä¸²è§£æä¸º `Version` ç»“æ„ä½“ã€‚

### è§£ææµç¨‹ï¼š

1. å…ˆæå– `major.minor.patch` éƒ¨åˆ†ï¼ˆå¿…é¡»å­˜åœ¨ï¼‰
2. æ‰¾åˆ° `-` æˆ– `+` æ ‡å¿—ä½ï¼Œåˆ†å‰²å‡º `pre` å’Œ `build`
3. éªŒè¯å„éƒ¨åˆ†åˆæ³•æ€§ï¼ˆè§åæ–‡ï¼‰

#### è¾…åŠ©å‡½æ•°ï¼š`parseNum`

```zig
fn parseNum(text: []const u8) error{ InvalidVersion, Overflow }!usize
```

è§£ææ•°å­—ï¼ŒåŒæ—¶æ£€æŸ¥ï¼š

- æ˜¯å¦ä»¥ `0` å¼€å¤´ï¼ˆå¦‚ `01` æ˜¯éæ³•çš„ï¼‰
- æ˜¯å¦æº¢å‡º `usize`

---

## âœ… åˆæ³•æ€§éªŒè¯è§„åˆ™ï¼ˆæ¥è‡ª SemVer è§„èŒƒï¼‰

### å¯¹ `pre` å’Œ `build` çš„é™åˆ¶ï¼š

| è§„åˆ™ | è¯´æ˜ |
|------|------|
| âŒ ä¸èƒ½æœ‰ç©ºæ ‡è¯†ç¬¦ | å¦‚ `1.0.0--alpha` ä¸åˆæ³• |
| âœ… åªèƒ½åŒ…å« ASCII å­—æ¯ã€æ•°å­—ã€è¿å­—ç¬¦ `-` | å¦‚ `1.0.0+meta.123-ok` åˆæ³• |
| âŒ æ•°å­—æ ‡è¯†ç¬¦ä¸èƒ½æœ‰å‰å¯¼é›¶ | å¦‚ `1.0.0-01` ä¸åˆæ³• |
| âœ… å…è®¸æ··åˆæ•°å­—ä¸éæ•°å­— | å¦‚ `1.0.0-alpha.1.beta` åˆæ³• |

è¿™äº›è§„åˆ™åœ¨ `parse` å‡½æ•°ä¸­é€šè¿‡å¾ªç¯æ£€æŸ¥æ¯ä¸ª `.` åˆ†éš”çš„éƒ¨åˆ†æ¥ç¡®ä¿ã€‚

---

## ğŸ–¨ï¸ æ ¼å¼åŒ–è¾“å‡ºï¼š`format`

```zig
pub fn format(self: Version, w: *std.Io.Writer) std.Io.Writer.Error!void
```

å°† `Version` å®ä¾‹æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²è¾“å‡ºï¼Œä¾‹å¦‚ï¼š

```zig
const v = Version{ .major=1, .minor=2, .patch=3, .pre="beta", .build="123" };
std.debug.print("{f}", .{v}); // è¾“å‡º: 1.2.3-beta+123
```

ä½¿ç”¨ `{f}` æ ¼å¼åŒ–æ ‡å¿—å³å¯è°ƒç”¨æ­¤æ–¹æ³•ã€‚

---

## ğŸ§ª å•å…ƒæµ‹è¯•

### 1. `test format`

æµ‹è¯•å¤§é‡æœ‰æ•ˆå’Œæ— æ•ˆçš„ç‰ˆæœ¬å­—ç¬¦ä¸²ï¼š

- âœ… **æœ‰æ•ˆç‰ˆæœ¬**ï¼šéªŒè¯èƒ½å¦æ­£ç¡®è§£æå¹¶é‡æ–°æ ¼å¼åŒ–è¾“å‡ºã€‚
- âŒ **æ— æ•ˆç‰ˆæœ¬**ï¼šéªŒè¯æ˜¯å¦è¿”å› `error.InvalidVersion`ã€‚

æ¶µç›–è¾¹ç•Œæƒ…å†µï¼š

- å¸¦å¤šæ®µé¢„å‘å¸ƒçš„ç‰ˆæœ¬
- åŒ…å«ç‰¹æ®Šå­—ç¬¦ä½†åˆæ³•çš„æ„å»ºå…ƒæ•°æ®
- å‰å¯¼é›¶æ£€æµ‹ï¼ˆå¦‚ `1.01.1` éæ³•ï¼‰
- ç©ºæ ‡è¯†ç¬¦æ£€æµ‹ï¼ˆå¦‚ `1.0.0..alpha` éæ³•ï¼‰

è¿˜æµ‹è¯•äº†å¯èƒ½æº¢å‡ºçš„å¤§æ•°å­—ç‰ˆæœ¬å·ã€‚

### 2. `test "precedence"`

éªŒè¯ç‰ˆæœ¬ä¼˜å…ˆçº§é¡ºåºæ˜¯å¦ç¬¦åˆè§„èŒƒã€‚

ä¾‹å¦‚ï¼š

```text
1.0.0-alpha < 1.0.0-alpha.1 < 1.0.0-alpha.beta < 1.0.0-beta < ... < 1.0.0
```

æ¯ä¸€çº§éƒ½é€šè¿‡ `order()` å‡½æ•°éªŒè¯ã€‚

### 3. `test "zig_version"`

æ¼”ç¤ºå¦‚ä½•åœ¨ç¼–è¯‘æœŸæ£€æŸ¥ Zig ç¼–è¯‘å™¨ç‰ˆæœ¬æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼š

```zig
const compatible = comptime @import("builtin").zig_version.order(older_version) == .gt;
if (!compatible) @compileError("zig_version test failed");
```

è¿™å¯ç”¨äºç¼–å†™ä¾èµ–ç‰¹å®š Zig ç‰ˆæœ¬çš„åº“ã€‚

---

## âœ… æ€»ç»“ï¼šè¿™ä¸ªæ¨¡å—å®ç°äº†ä»€ä¹ˆï¼Ÿ

| åŠŸèƒ½ | æ˜¯å¦æ”¯æŒ |
|------|----------|
| âœ… è§£æ SemVer å­—ç¬¦ä¸² | âœ”ï¸ |
| âœ… æ„é€ ç‰ˆæœ¬å¯¹è±¡ | âœ”ï¸ |
| âœ… æ ¼å¼åŒ–è¾“å‡º | âœ”ï¸ |
| âœ… æ­£ç¡®çš„ç‰ˆæœ¬ä¼˜å…ˆçº§æ¯”è¾ƒï¼ˆå«é¢„å‘å¸ƒï¼‰ | âœ”ï¸ |
| âœ… ä¸¥æ ¼çš„åˆæ³•æ€§éªŒè¯ï¼ˆå‰å¯¼é›¶ã€å­—ç¬¦é›†ç­‰ï¼‰ | âœ”ï¸ |
| âœ… æ”¯æŒæ„å»ºå…ƒæ•°æ®ï¼ˆä»…å­˜å‚¨ï¼Œä¸æ¯”è¾ƒï¼‰ | âœ”ï¸ |
| âœ… ç‰ˆæœ¬èŒƒå›´æ£€æŸ¥ | âœ”ï¸ |
| âœ… ç¼–è¯‘æœŸç‰ˆæœ¬å…¼å®¹æ€§åˆ¤æ–­ | âœ”ï¸ |

---

## ğŸ“š å‚è€ƒï¼šSemVer 2.0.0 æ ¸å¿ƒè§„åˆ™å›é¡¾

ä¸€ä¸ªåˆæ³•çš„ç‰ˆæœ¬å·æ ¼å¼ä¸ºï¼š

```
MAJOR.MINOR.PATCH[-PRERELEASE][+BUILD]
```

- **MAJOR**ï¼šé‡å¤§å˜æ›´ï¼Œä¸å…¼å®¹ API
- **MINOR**ï¼šæ–°å¢åŠŸèƒ½ï¼Œå‘åå…¼å®¹
- **PATCH**ï¼šä¿®å¤è¡¥ä¸ï¼Œå‘åå…¼å®¹
- **PRERELEASE**ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚ `alpha`, `beta`, `rc`
- **BUILD**ï¼ˆå¯é€‰ï¼‰ï¼šæ„å»ºä¿¡æ¯ï¼Œä¸å‚ä¸æ¯”è¾ƒ

ä¼˜å…ˆçº§è§„åˆ™ï¼š
> `ä¸» â†’ æ¬¡ â†’ ä¿®è®¢ â†’ é¢„å‘å¸ƒ`ï¼ˆæ„å»ºå…ƒæ•°æ®å¿½ç•¥ï¼‰

---

## ğŸ›  ä½¿ç”¨å»ºè®®

ä½ å¯ä»¥è¿™æ ·ä½¿ç”¨è¿™ä¸ªæ¨¡å—ï¼š

```zig
const ver = try Version.parse("2.1.0-beta.2");
const target = try Version.parse("2.1.0");

if (ver.order(target) == .lt) {
    std.debug.print("å½“å‰ç‰ˆæœ¬è¾ƒæ—§\n", .{});
}
```

æˆ–ç”¨äºåŒ…ç®¡ç†å™¨ã€ä¾èµ–è§£æã€å…¼å®¹æ€§æ£€æŸ¥ç­‰åœºæ™¯ã€‚

---

âœ… **ç»“è®º**ï¼šè¿™æ˜¯ä¸€ä¸ªå®Œæ•´ã€ä¸¥è°¨ã€ç¬¦åˆæ ‡å‡†çš„ **Semantic Versioning 2.0.0** å®ç°ï¼Œé€‚ç”¨äº Zig ç”Ÿæ€ä¸­çš„ç‰ˆæœ¬ç®¡ç†éœ€æ±‚ã€‚